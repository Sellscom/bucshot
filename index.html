<!DOCTYPE html>
<html lang="ru">
<head>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <script>
    // Подключение к вашему серверу на Render
    const socket = io('https://bucshot.onrender.com');
    let currentRoom = "global_room"; // Можно динамически менять для разных игр
    let myId = null;

    // Расширение STATE для мультиплеера
    const STATE = {
        round: 1, playerHP: 2, dealerHP: 2, maxHP: 2,
        playerLostHP: 0, dealerLostHP: 0,
        ammo: [], liveLeft: 0, blankLeft: 0,
        pInv: [], dInv: [], 
        isX2: false, dCuffed: false, pCuffed: false,
        turn: 'player', busy: false, muted: false,
        isMultiplayer: true, 
        isMyTurn: false
    };

    // [Функции звуков, загрузки ресурсов остаются прежними]

    socket.on('connect', () => {
        myId = socket.id;
        socket.emit('joinRoom', currentRoom);
    });

    socket.on('startGame', (data) => {
        STATE.isMyTurn = (data.firstTurn === myId);
        document.getElementById('main-menu').style.display = 'none';
        document.getElementById('game-view').style.display = 'flex';
        msg(STATE.isMyTurn ? "ВАШ ХОД" : "ХОД ОППОНЕНТА");
        startRound();
    });

    // Перехват выстрела для отправки по сети
    async function shoot(target) {
        if(!STATE.isMyTurn || STATE.busy) return;
        
        // Отправляем действие на сервер
        socket.emit('action', {
            type: 'shoot',
            target: target,
            roomId: currentRoom
        });

        STATE.busy = true;
        await processShoot(target);
    }

    // Обработка действий оппонента
    socket.on('opponentAction', async (data) => {
        if(data.type === 'shoot') {
            // Если оппонент стреляет в "opponent" (в нас), для нас это target "self"
            const adjustedTarget = (data.target === 'opponent') ? 'self' : 'opponent';
            await processShoot(adjustedTarget);
        } else if(data.type === 'useItem') {
            await useItem(data.itemIdx, false);
        }
    });

    // Изменение логики передачи хода
    function checkState() {
        if(STATE.playerHP <= 0 || STATE.dealerHP <= 0) {
            // Логика конца раунда...
        }
        
        // В мультиплеере мы не вызываем dealerAI, а ждем сообщения от socket
        STATE.busy = false;
        updateUI();
    }

    function updateUI() {
        // [Предыдущий код отрисовки HP и инвентаря]
        document.getElementById('turn-status').innerText = STATE.isMyTurn ? "ВАШ ХОД" : "ХОД ОППОНЕНТА";
        document.getElementById('turn-status').style.background = STATE.isMyTurn ? 'rgba(0,255,0,0.2)' : 'rgba(255,0,0,0.2)';
    }

    // Использование предмета через сеть
    async function useItem(idx, isPlayer) {
        if(isPlayer && (!STATE.isMyTurn || STATE.busy)) return;

        if(isPlayer) {
            socket.emit('action', {
                type: 'useItem',
                itemIdx: idx,
                roomId: currentRoom
            });
        }
        
        // [Остальная логика предметов остается прежней]
    }

    // Остальные функции (renderHP, msg, sleep) остаются без изменений
</script>
</body>
</html>
